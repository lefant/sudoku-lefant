<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>Haskell code</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><span class='hs-comment'>-- Lefants haskell sudoku solver</span>
<span class='hs-comment'>-- -----------------------------</span>

<span class='hs-comment'>{-# OPTIONS -O2 -Wall -Werror -Wwarn #-}</span>

<span class='hs-comment'>-- This is the main module, containing the actual logic.</span>

<span class='hs-keyword'>module</span> <span class='hs-conid'>Sudoku</span> <span class='hs-layout'>(</span>
               <span class='hs-varid'>solveOne</span><span class='hs-layout'>,</span>
              <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>


<span class='hs-comment'>{-
There are two helpers:

 * sudoku-test runs some (very very basic) tests.
 * sudoku-run is the binary for normal invocation, it will read from
   stdin and output to stdout. use it like this:

$ cat &lt;&lt;EOF | ./sudoku-run
.98......
....7....
....15...
1........
...2....9
...9.6.82
.......3.
5.1......
...4...2.
EOF

798624315
315879246
264315978
129587463
683241759
457936182
942158637
531762894
876493521
-}</span>




<span class='hs-comment'>{-
The Coord type is a three-dimensional coordinate, the 3rd one is the
box the field is in, like indicated here:

+-----------+
|111|222|333|
|111|222|333|
|111|222|333|
+-----------+
|444|555|666|
|444|555|666|
|444|555|666|
+-----------+
|777|888|999|
|777|888|999|
|777|888|999|
+-----------+
-}</span>

<span class='hs-keyword'>type</span> <span class='hs-conid'>Coord</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>



<span class='hs-comment'>-- Value holds a solution value or a list of remaining valid</span>
<span class='hs-comment'>-- candidates for the field.</span>

<span class='hs-keyword'>data</span> <span class='hs-conid'>Value</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Element</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Options</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span>
           <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>

<span class='hs-comment'>-- An actual field consists of a coordinate and a Value (as described</span>
<span class='hs-comment'>-- above).</span>

<span class='hs-keyword'>type</span> <span class='hs-conid'>Pair</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Coord</span><span class='hs-layout'>,</span> <span class='hs-conid'>Value</span><span class='hs-layout'>)</span>



<span class='hs-comment'>-- This is the main exported function. It will read in a string of</span>
<span class='hs-comment'>-- digits or . and feed it to the solve' function which will find a</span>
<span class='hs-comment'>-- solution using solve and then return a prettified string</span>
<span class='hs-comment'>-- representation.</span>

<span class='hs-definition'>solveOne</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<span class='hs-definition'>solveOne</span> <span class='hs-varid'>ls</span> <span class='hs-keyglyph'>=</span>
    <span class='hs-varid'>concatMap</span> <span class='hs-varid'>pretty</span> <span class='hs-varop'>$</span>
    <span class='hs-varid'>sortBy</span> <span class='hs-varid'>compareC</span> <span class='hs-varop'>$</span>
    <span class='hs-varid'>solve'</span> <span class='hs-varop'>$</span>
    <span class='hs-varid'>zip</span> <span class='hs-varid'>triples</span> <span class='hs-varop'>$</span>
    <span class='hs-varid'>map</span> <span class='hs-varid'>readOne</span> <span class='hs-varid'>ls</span>


<span class='hs-comment'>-- This will return a list of three-dimensional coordinates as</span>
<span class='hs-comment'>-- explained with the Coord type above.</span>

<span class='hs-definition'>triples</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Coord</span><span class='hs-keyglyph'>]</span>
<span class='hs-definition'>triples</span> <span class='hs-keyglyph'>=</span>
    <span class='hs-varid'>zip3</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>z</span> <span class='hs-varid'>pairs</span>
    <span class='hs-keyword'>where</span>
      <span class='hs-varid'>pairs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-varid'>a'</span><span class='hs-layout'>,</span> <span class='hs-varid'>b'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>1</span><span class='hs-keyglyph'>..</span><span class='hs-num'>9</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>1</span><span class='hs-keyglyph'>..</span><span class='hs-num'>9</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
      <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unzip</span> <span class='hs-varid'>pairs</span>

      <span class='hs-varid'>z</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
      <span class='hs-varid'>z</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
          <span class='hs-varid'>x2z</span> <span class='hs-varop'>+</span> <span class='hs-varid'>y2z</span>
          <span class='hs-keyword'>where</span>
            <span class='hs-varid'>x2z</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`div`</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span>
            <span class='hs-varid'>y2z</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>y</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>`div`</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span> <span class='hs-varop'>*</span> <span class='hs-num'>3</span>


<span class='hs-comment'>-- Pretty representation of field values</span>

<span class='hs-definition'>pretty</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-conid'>Value</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<span class='hs-definition'>pretty</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varid'>e</span>
<span class='hs-definition'>pretty</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>""</span>


<span class='hs-comment'>-- Used for sorting coordinates from left to right and top to bottom.</span>

<span class='hs-definition'>compareC</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>t2</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>t3</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span>
            <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>t2</span><span class='hs-layout'>,</span> <span class='hs-varid'>t3</span><span class='hs-layout'>,</span> <span class='hs-varid'>t4</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>t2</span><span class='hs-layout'>,</span> <span class='hs-varid'>t3</span><span class='hs-layout'>,</span> <span class='hs-varid'>t5</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>t1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<span class='hs-definition'>compareC</span> <span class='hs-layout'>(</span><span class='hs-varid'>c1</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>c2</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
    <span class='hs-varid'>compareT</span> <span class='hs-varid'>c1</span> <span class='hs-varid'>c2</span>
    <span class='hs-keyword'>where</span>
      <span class='hs-varid'>compareT</span> <span class='hs-layout'>(</span><span class='hs-varid'>a1</span><span class='hs-layout'>,</span> <span class='hs-varid'>b1</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>a2</span><span class='hs-layout'>,</span> <span class='hs-varid'>b2</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>b1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>b2</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compare</span> <span class='hs-varid'>a1</span> <span class='hs-varid'>a2</span>
          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compare</span> <span class='hs-varid'>b1</span> <span class='hs-varid'>b2</span>



<span class='hs-comment'>-- Read in a predefined single value or failing that initialize the</span>
<span class='hs-comment'>-- list of options.</span>

<span class='hs-definition'>readOne</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Value</span>
<span class='hs-definition'>readOne</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span>
    <span class='hs-keyword'>case</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`elem`</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>head</span><span class='hs-varop'>.</span><span class='hs-varid'>show</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>[</span><span class='hs-num'>1</span><span class='hs-keyglyph'>..</span><span class='hs-num'>9</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Int</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
      <span class='hs-conid'>True</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Element</span> <span class='hs-layout'>(</span><span class='hs-varid'>read</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
      <span class='hs-conid'>False</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Options</span> <span class='hs-keyglyph'>[</span><span class='hs-num'>1</span><span class='hs-keyglyph'>..</span><span class='hs-num'>9</span><span class='hs-keyglyph'>]</span>



<span class='hs-comment'>-- solve' and solve contain the actual solving logic. solve' will</span>
<span class='hs-comment'>-- partition the initial list of fields into ones containing single</span>
<span class='hs-comment'>-- elements (already defined / solved) and those containing a list of</span>
<span class='hs-comment'>-- remaining options.</span>

<span class='hs-definition'>solve'</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Pair</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Pair</span><span class='hs-keyglyph'>]</span>
<span class='hs-definition'>solve'</span> <span class='hs-varid'>ls</span> <span class='hs-keyglyph'>=</span>
    <span class='hs-varid'>solution</span>
    <span class='hs-keyword'>where</span>
      <span class='hs-conid'>Just</span> <span class='hs-varid'>solution</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>solve</span> <span class='hs-varid'>done</span> <span class='hs-varid'>todo</span>
      <span class='hs-layout'>(</span><span class='hs-varid'>done</span><span class='hs-layout'>,</span> <span class='hs-varid'>todo</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>partition</span> <span class='hs-varid'>isElement</span> <span class='hs-varid'>ls</span>
      <span class='hs-varid'>isElement</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-conid'>Value</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
      <span class='hs-varid'>isElement</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
      <span class='hs-varid'>isElement</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>


<span class='hs-comment'>-- solve takes two lists of coordinate / value pairs as parameters:</span>
<span class='hs-comment'>-- the first one contains solved single element fields, the second all</span>
<span class='hs-comment'>-- the lists with remaining options.</span>

<span class='hs-definition'>solve</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Pair</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Pair</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Pair</span><span class='hs-keyglyph'>]</span>
<span class='hs-comment'>-- if all the fields have one element we are done.</span>
<span class='hs-definition'>solve</span> <span class='hs-varid'>es</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>es</span>
<span class='hs-definition'>solve</span> <span class='hs-varid'>es</span> <span class='hs-varid'>os</span> <span class='hs-keyglyph'>=</span>
    <span class='hs-keyword'>case</span> <span class='hs-keyword'>as</span> <span class='hs-keyword'>of</span>
      <span class='hs-comment'>-- no more Options, no solutions possible</span>
      <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
      <span class='hs-comment'>-- try first option</span>
      <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>as'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span>
          <span class='hs-comment'>-- recurse using backtracking, if we can solve it</span>
          <span class='hs-keyword'>case</span> <span class='hs-varid'>solve</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-varid'>os'</span> <span class='hs-keyword'>of</span>
            <span class='hs-comment'>-- we are done</span>
            <span class='hs-conid'>Just</span> <span class='hs-varid'>es'</span> <span class='hs-keyglyph'>-&gt;</span>
                <span class='hs-conid'>Just</span> <span class='hs-varid'>es'</span>
            <span class='hs-comment'>-- this branch contains no solutions, retry without it</span>
            <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span>
                <span class='hs-varid'>solve</span> <span class='hs-varid'>es</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-varid'>as'</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>os'</span><span class='hs-layout'>)</span>

    <span class='hs-keyword'>where</span>
      <span class='hs-comment'>-- first prune all Options list at the current level, then order</span>
      <span class='hs-comment'>-- branches with *few* options first</span>
      <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-keyword'>as</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>os'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sortBy</span> <span class='hs-varid'>lessOptions</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>revaluate</span> <span class='hs-varid'>os</span>

      <span class='hs-varid'>lessOptions</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
          <span class='hs-varid'>compare</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>length</span> <span class='hs-varid'>ys</span><span class='hs-layout'>)</span>
      <span class='hs-varid'>lessOptions</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span>
          <span class='hs-varid'>error</span> <span class='hs-str'>"illegal lessOptions call"</span>
      <span class='hs-varid'>lessOptions</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
          <span class='hs-varid'>error</span> <span class='hs-str'>"illegal lessOptions call"</span>

      <span class='hs-comment'>-- filter out other Options from list that are made impossible</span>
      <span class='hs-comment'>-- by choosing a certain one</span>
      <span class='hs-varid'>revaluate</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pair</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Pair</span>
      <span class='hs-varid'>revaluate</span> <span class='hs-layout'>(</span><span class='hs-varid'>c'</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-varid'>aas</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
          <span class='hs-comment'>{-# SCC "revaluate" #-}</span>
          <span class='hs-layout'>(</span><span class='hs-varid'>c'</span><span class='hs-layout'>,</span> <span class='hs-conid'>Options</span> <span class='hs-varid'>aas'</span><span class='hs-layout'>)</span>
          <span class='hs-keyword'>where</span>
            <span class='hs-varid'>aas'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>aas</span> <span class='hs-varop'>\\</span> <span class='hs-varid'>otherValues</span>
            <span class='hs-varid'>otherValues</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
                          <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>==</span> <span class='hs-varid'>px</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span>
                           <span class='hs-layout'>(</span><span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>y</span> <span class='hs-varop'>==</span> <span class='hs-varid'>py</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span>
                           <span class='hs-layout'>(</span><span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>z</span> <span class='hs-varop'>==</span> <span class='hs-varid'>pz</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
      <span class='hs-varid'>revaluate</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Element</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
          <span class='hs-varid'>error</span> <span class='hs-str'>"illegal revaluate call"</span>


<span class='hs-comment'>-- helper functions to project a single coordinate from a Pair</span>

<span class='hs-definition'>px</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pair</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class='hs-definition'>px</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<span class='hs-definition'>py</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pair</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class='hs-definition'>py</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>y</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>y</span>
<span class='hs-definition'>pz</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pair</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class='hs-definition'>pz</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>z</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>z</span>
</pre></body>
</html>
